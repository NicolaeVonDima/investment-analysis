# Cursor Project Rules — Investment Analysis Platform

## Prime Directive
You are operating inside a long-term, rules-based investment analysis platform.
Optimize for:
- Reproducibility (same inputs → same outputs)
- Auditability (every number traceable to a snapshot & source)
- Reuse-first engineering (avoid duplicate logic)
- Long-term horizons (no day trading, no live data dependency)

---

## Canonical Context Files (MUST exist at repo root)
Create if missing and keep updated using append-only history:
- Specifications.md
- Architecture.md
- ProjectStatus.md

## Strongly Recommended Context Files
Create when first needed and maintain append-only history:
- Decisions.md (or /adr/) — architectural decisions and rationale
- DataSources.md — providers, endpoints, cadence, limitations, licensing
- Backlog.md — prioritized future work
- Glossary.md — canonical domain terminology
- Runbook.md — local run, refresh, troubleshooting, deployment
- ImplementationNotes.md — optional concise implementation log
- TestPlan.md — testing structure, commands, gaps

---

## Global Behavioral Rules (Apply to EVERY request)
1. Always read existing context files before proposing changes.
2. Never overwrite history in any context file.
   - Append using YYYY-MM-DD timestamps.
   - Include version identifiers where applicable (ruleset/prompt/template vX.Y.Z).
3. If a request conflicts with existing Specifications or Architecture:
   - Explicitly flag the conflict.
   - Ask for clarification BEFORE implementation.
4. Prefer reuse over new code:
   - Extend existing modules first.
   - Introduce new modules only as last resort.
   - Record justification in Decisions.md.
5. Never invent data:
   - Narratives must only reference computed inputs.
   - Use only documented data sources and schemas.
6. Treat snapshots and analyses as immutable artifacts:
   - Refresh creates new snapshots.
   - Never mutate historical data.
   - Always store source + as-of metadata.

---

## Required Workflow Contract (STRICT)
Every change request MUST follow this lifecycle:

A) Specification Review  
B) Architecture Impact Analysis  
C) Context Update  
D) Implementation  
E) Testing  
F) Status & Git Commit  

### Role responsibilities
- Spec Reviewer:
  - Validates request against Specifications.md.
  - Blocks conflicting or ambiguous scope.

- Architecture Reviewer:
  - Assesses impact using Architecture.md.
  - Enforces reuse-first design.
  - Records major choices in Decisions.md.

- Context Keeper:
  - Updates Specifications.md, Architecture.md, ProjectStatus.md.
  - Ensures optional context files stay consistent.

- Implementation Agent:
  - Implements ONLY approved spec deltas.
  - Produces minimal diffs.
  - Updates ProjectStatus.md and ImplementationNotes.md (if present).

- Testing Agent:
  - Adds/updates unit, integration, and golden tests.
  - Runs tests when possible.
  - Produces PASS / FAIL outcome.
  - Updates risks and gaps in ProjectStatus.md.

---

## Platform Invariants (DO NOT violate unless explicitly approved)
- End-of-day and periodic data only (no live feeds).
- Global shared refresh per (ticker, as_of_date).
- Watchlist refresh universe = union of active watchlists.
- Append-only snapshots for:
  - raw data
  - derived metrics
  - evidence factors
  - memos
- Versioned rulesets, prompts, templates.
- Portfolio logic must consume analysis; never embed portfolio logic into ticker analysis.

---

## Git Commit & Push Policy (ENFORCED)
After a FULL workflow completion:

1. Cursor MUST:
   - Run `git status`.
   - Summarize all changed files.
   - Propose a structured commit message.

2. Cursor MUST ask explicitly:
   “Approve commit and push to origin?”

3. Cursor MAY execute `git commit` and `git push`
   ONLY after explicit user approval.

4. Commit message format:

   <type>: <short summary>

   - Scope: <feature/module>
   - Specs: <spec reference>
   - Tests: <added/updated/none>
   - Notes: <migrations, risks, follow-ups>

5. No force-pushes.
6. No direct pushes to protected branches unless explicitly approved.

---

## Output Expectations
- Prefer patch/diff outputs.
- If full files are changed, clearly list filenames.
- Keep documentation concise, structured, and scannable.